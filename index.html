<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Get Current Location</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
      }

      .container {
        text-align: center;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
      }

      p {
        margin: 10px 0;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <button id="getLocationButton">Get Current Location</button>
      <p id="locationOutput"></p>
      <p id="distanceOutput"></p>
      <p id="proximityOutput"></p>
      <p id="errorOutput"></p>
      <div>
        <hr />
        <p>에러 코드 1: 사용자가 위치 정보 요청을 거부했습니다.</p>
        <p>에러 코드 2: 위치 정보를 사용할 수 없습니다.</p>
        <p>에러 코드 3: 위치 정보 요청 시간이 초과되었습니다.</p>
        <p>에러 코드 0: 알 수 없는 에러가 발생했습니다.</p>
      </div>
    </div>
    <script>
      document
        .getElementById("getLocationButton")
        .addEventListener("click", () => {
          const locationOutput = document.getElementById("locationOutput");
          const distanceOutput = document.getElementById("distanceOutput");
          const proximityOutput = document.getElementById("proximityOutput");
          const errorOutput = document.getElementById("errorOutput");
          const errorObjectOutput = document.getElementById("errorObject");
          locationOutput.textContent = "";
          distanceOutput.textContent = "";
          proximityOutput.textContent = "";
          errorOutput.textContent = "";
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
          } else {
            errorOutput.textContent =
              "Geolocation is not supported by this browser.";
          }

          function showPosition(position) {
            const currentLatitude = position.coords.latitude;
            const currentLongitude = position.coords.longitude;
            const distance = calculateDistance(
              currentLatitude,
              currentLongitude,
              37.395635,
              127.112555
            );
            console.log(
              "성공!",
              position,
              currentLatitude,
              currentLongitude,
              distance
            );
            locationOutput.textContent = `Latitude: ${currentLatitude}, Longitude: ${currentLongitude}`;
            distanceOutput.textContent = `Pangyo Techone으로부터 거리: ${distance.toFixed(
              2
            )} km`;
            proximityOutput.textContent =
              distance <= 5
                ? "Pangyo Techone으로부터 5km 이내: Y"
                : "Pangyo Techone으로부터 5km 이내: N";
          }

          function showError(error) {
            console.log("에러!", error);
            if (error.message) {
              errorOutput.textContent = `Error code: ${error.code}, Message: ${error.message}`;
            } else {
              errorOutput.textContent = `Error code: ${error.code}`;
            }
          }

          function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a =
              Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(deg2rad(lat1)) *
                Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) *
                Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c;
            return distance;
          }

          function deg2rad(deg) {
            return deg * (Math.PI / 180);
          }
        });
    </script>
  </body>
</html>
